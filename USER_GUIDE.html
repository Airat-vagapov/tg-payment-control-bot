<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.2">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Light'}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Light'; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1"># –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: tg-payment-control-bot</p>
<p class="p2"><br></p>
<p class="p1">## –ß—Ç–æ —ç—Ç–æ</p>
<p class="p2"><br></p>
<p class="p1">`tg-payment-control-bot` ‚Äî Telegram-–±–æ—Ç –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –≤ –≥—Ä—É–ø–ø–µ:</p>
<p class="p1">- —Å–æ–∑–¥–∞–µ—Ç —Å—á–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫—É –∑–∞ —Ç–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥;</p>
<p class="p1">- –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã;</p>
<p class="p1">- –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ —É–º–µ–µ—Ç –æ—Ç–º–µ—á–∞—Ç—å –æ–ø–ª–∞—Ç—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é;</p>
<p class="p1">- –≤ –º–æ–º–µ–Ω—Ç –¥–µ–¥–ª–∞–π–Ω–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å–∞–Ω–∫—Ü–∏—é –¥–ª—è –¥–æ–ª–∂–Ω–∏–∫–∞.</p>
<p class="p2"><br></p>
<p class="p1">## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è</p>
<p class="p2"><br></p>
<p class="p1">- Node.js 20+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–π LTS)</p>
<p class="p1">- Docker (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ PostgreSQL)</p>
<p class="p1">- Telegram-–±–æ—Ç (—Ç–æ–∫–µ–Ω –æ—Ç BotFather)</p>
<p class="p2"><br></p>
<p class="p1">## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</p>
<p class="p2"><br></p>
<p class="p1">### 1) –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏</p>
<p class="p2"><br></p>
<p class="p1">```bash</p>
<p class="p1">npm install</p>
<p class="p1">```</p>
<p class="p2"><br></p>
<p class="p1">### 2) –ü–æ–¥–Ω–∏–º–∏—Ç–µ PostgreSQL</p>
<p class="p2"><br></p>
<p class="p1">```bash</p>
<p class="p1">docker compose up -d db</p>
<p class="p1">```</p>
<p class="p2"><br></p>
<p class="p1">### 3) –ó–∞–ø–æ–ª–Ω–∏—Ç–µ `.env`</p>
<p class="p2"><br></p>
<p class="p1">–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:</p>
<p class="p2"><br></p>
<p class="p1">- `BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞</p>
<p class="p1">- `DATABASE_URL` ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL</p>
<p class="p2"><br></p>
<p class="p1">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ/–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:</p>
<p class="p2"><br></p>
<p class="p1">- `PORT` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `3000`)</p>
<p class="p1">- `DEFAULT_AMOUNT_CENTS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `50000`)</p>
<p class="p1">- `DEFAULT_TZ` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `Europe/Berlin`)</p>
<p class="p1">- `DEFAULT_DUE_DAY` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `5`)</p>
<p class="p1">- `DEFAULT_DUE_HOUR` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `18`)</p>
<p class="p1">- `ALLOWED_GROUP_CHAT_ID` (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω, –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ)</p>
<p class="p1">- `WEBHOOK_BASE_URL` (–¥–ª—è –±—É–¥—É—â–µ–≥–æ webhook-—Å—Ü–µ–Ω–∞—Ä–∏—è)</p>
<p class="p1">- `TEST_DUE_IN_MINUTES` (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∞: –¥–µ–¥–ª–∞–π–Ω —á–µ—Ä–µ–∑ N –º–∏–Ω—É—Ç)</p>
<p class="p2"><br></p>
<p class="p1">–ü—Ä–∏–º–µ—Ä `DATABASE_URL`:</p>
<p class="p2"><br></p>
<p class="p1">```env</p>
<p class="p1">DATABASE_URL=postgresql://postgres:postgres@localhost:5432/tgpay</p>
<p class="p1">```</p>
<p class="p2"><br></p>
<p class="p1">### 4) –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ö–µ–º—É –ë–î</p>
<p class="p2"><br></p>
<p class="p1">```bash</p>
<p class="p1">npm run prisma:push</p>
<p class="p1">```</p>
<p class="p2"><br></p>
<p class="p1">### 5) –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞</p>
<p class="p2"><br></p>
<p class="p1">```bash</p>
<p class="p1">npm run dev</p>
<p class="p1">```</p>
<p class="p2"><br></p>
<p class="p1">## –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ Telegram</p>
<p class="p2"><br></p>
<p class="p1">### `/setup` (–≤ –≥—Ä—É–ø–ø–µ, –æ–±—ã—á–Ω–æ –∞–¥–º–∏–Ω)</p>
<p class="p2"><br></p>
<p class="p1">–ü–æ–¥–∫–ª—é—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é –≥—Ä—É–ø–ø—É –∫ –±–æ—Ç—É –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –±–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</p>
<p class="p1">- —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞;</p>
<p class="p1">- —Ç–∞–π–º–∑–æ–Ω–∞;</p>
<p class="p1">- –¥–µ–Ω—å/—á–∞—Å –¥–µ–¥–ª–∞–π–Ω–∞.</p>
<p class="p2"><br></p>
<p class="p1">### `/pay`</p>
<p class="p2"><br></p>
<p class="p1">–°–æ–∑–¥–∞–µ—Ç (–∏–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π) —Å—á–µ—Ç –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏:</p>
<p class="p1">- `üí≥ –û–ø–ª–∞—Ç–∏—Ç—å` ‚Äî –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ —Å–æ–∑–¥–∞–µ—Ç mock-–ø–ª–∞—Ç–µ–∂ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`;</p>
<p class="p1">- `‚úÖ –¢–µ—Å—Ç: –æ—Ç–º–µ—Ç–∏—Ç—å –æ–ø–ª–∞—á–µ–Ω–æ` ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–≤–∏—Ç –æ–ø–ª–∞—Ç—É –≤ `paid` (–¥–ª—è —Ç–µ—Å—Ç–∞).</p>
<p class="p2"><br></p>
<p class="p1">### `/status`</p>
<p class="p2"><br></p>
<p class="p1">–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—á–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ —Ç–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥:</p>
<p class="p1">- `unpaid`, `pending`, `paid`, `excused`, `kicked`.</p>
<p class="p2"><br></p>
<p class="p1">## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–µ–¥–ª–∞–π–Ω</p>
<p class="p2"><br></p>
<p class="p1">- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—á–µ—Ç–∞ –±–æ—Ç —Å—Ç–∞–≤–∏—Ç –æ—Ç–ª–æ–∂–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É (`pg-boss`) –Ω–∞ –≤—Ä–µ–º—è `dueAt`.</p>
<p class="p1">- –í –º–æ–º–µ–Ω—Ç –¥–µ–¥–ª–∞–π–Ω–∞ –∑–∞–¥–∞—á–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—á–µ—Ç:</p>
<p class="p1"><span class="Apple-converted-space">¬† </span>- –µ—Å–ª–∏ `paid`/`excused` ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç;</p>
<p class="p1"><span class="Apple-converted-space">¬† </span>- –µ—Å–ª–∏ –Ω–µ –æ–ø–ª–∞—á–µ–Ω ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å–∞–Ω–∫—Ü–∏—é (kick) –∏ –ø–∏—à–µ—Ç –∞—É–¥–∏—Ç.</p>
<p class="p1">- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è: —ç—Ç–æ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—á–µ—Ç.</p>
<p class="p2"><br></p>
<p class="p1">## –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</p>
<p class="p2"><br></p>
<p class="p1">1. –ü–æ—Å—Ç–∞–≤—å—Ç–µ `TEST_DUE_IN_MINUTES=2` –≤ `.env`.</p>
<p class="p1">2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ `npm run dev`.</p>
<p class="p1">3. –í –≥—Ä—É–ø–ø–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `/setup`, –∑–∞—Ç–µ–º `/pay`.</p>
<p class="p1">4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:</p>
<p class="p1"><span class="Apple-converted-space">¬†¬† </span>- –≤–∞—Ä–∏–∞–Ω—Ç A: –Ω–∞–∂–∞—Ç—å `‚úÖ –¢–µ—Å—Ç: –æ—Ç–º–µ—Ç–∏—Ç—å –æ–ø–ª–∞—á–µ–Ω–æ` –∏ –¥–æ–∂–¥–∞—Ç—å—Å—è –¥–µ–¥–ª–∞–π–Ω–∞ (—Å–∞–Ω–∫—Ü–∏–∏ –Ω–µ –±—É–¥–µ—Ç);</p>
<p class="p1"><span class="Apple-converted-space">¬†¬† </span>- –≤–∞—Ä–∏–∞–Ω—Ç B: –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–∂–∏–º–∞—Ç—å –∏ –¥–æ–∂–¥–∞—Ç—å—Å—è –¥–µ–¥–ª–∞–π–Ω–∞ (—Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∞–Ω–∫—Ü–∏—è).</p>
<p class="p2"><br></p>
<p class="p1">## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã</p>
<p class="p2"><br></p>
<p class="p1">- –ó–∞–ø—É—Å–∫ –≤ dev: `npm run dev`</p>
<p class="p1">- –°–±–æ—Ä–∫–∞: `npm run build`</p>
<p class="p1">- –ó–∞–ø—É—Å–∫ —Å–æ–±—Ä–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏: `npm run start`</p>
<p class="p1">- –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –ë–î: `npm run prisma:push`</p>
<p class="p1">- Prisma Studio: `npm run prisma:studio`</p>
<p class="p2"><br></p>
<p class="p1">## –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã</p>
<p class="p2"><br></p>
<p class="p1">- –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –≤ –≥—Ä—É–ø–ø–µ:</p>
<p class="p1"><span class="Apple-converted-space">¬† </span>- –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É;</p>
<p class="p1"><span class="Apple-converted-space">¬† </span>- –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `ALLOWED_GROUP_CHAT_ID` (–º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —á—É–∂–∏–µ —á–∞—Ç—ã);</p>
<p class="p1"><span class="Apple-converted-space">¬† </span>- —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ –≤ –≥—Ä—É–ø–ø–µ (`/setup`, `/pay`, `/status`).</p>
<p class="p2"><br></p>
<p class="p1">- –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î:</p>
<p class="p1"><span class="Apple-converted-space">¬† </span>- –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `DATABASE_URL`;</p>
<p class="p1"><span class="Apple-converted-space">¬† </span>- –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `db` –ø–æ–¥–Ω—è—Ç (`docker compose ps`).</p>
<p class="p2"><br></p>
<p class="p1">- –°–∞–Ω–∫—Ü–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞:</p>
<p class="p1"><span class="Apple-converted-space">¬† </span>- –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ (–¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å –±–∞–Ω–∏—Ç—å/–∫–∏–∫–∞—Ç—å);</p>
<p class="p1"><span class="Apple-converted-space">¬† </span>- –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ (`npm run dev`), —Ç–∞–º –ø–∏—à—É—Ç—Å—è —Å–æ–±—ã—Ç–∏—è –¥–∂–æ–±.</p>
<p class="p2"><br></p>
<p class="p1">## –í–∞–∂–Ω–æ –ø—Ä–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω</p>
<p class="p2"><br></p>
<p class="p1">–°–µ–π—á–∞—Å –ø—Ä–æ–µ–∫—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é/—Ç–µ—Å—Ç–æ–≤—É—é —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é:</p>
<p class="p1">- –≤ `index.ts` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è long polling (`bot.start()`);</p>
<p class="p1">- endpoint `/payments/webhook` –ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞;</p>
<p class="p1">- —Ä–µ–∞–ª—å–Ω—ã–π –ø–ª–∞—Ç–µ–∂–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –µ—â–µ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω.</p>
</body>
</html>
